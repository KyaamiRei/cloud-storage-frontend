# UML Диаграммы системы облачного хранилища

Этот каталог содержит UML диаграммы системы облачного хранилища файлов, созданные в формате PlantUML.

## Список диаграмм

Все диаграммы доступны в двух форматах:
- **PlantUML** (`.puml`) - оригинальный формат
- **Mermaid** (`.mmd`) - современный формат, поддерживаемый GitHub, GitLab и многими другими платформами

### 1. Диаграмма классов (`1-диаграмма-классов.puml` / `1-диаграмма-классов.mmd`)
Показывает структуру классов системы, включая:
- Сущности базы данных (UserEntity, FileEntity)
- Сервисы (UsersService, FilesService, AuthService)
- Контроллеры (UsersController, FilesController, AuthController)
- Стратегии аутентификации и Guards
- Связи между классами

### 1a. Диаграмма классов (упрощенная) (`1-диаграмма-классов-упрощенная.mmd`)
Упрощенная версия диаграммы классов, показывающая только основные объекты приложения:
- Сущности базы данных (UserEntity, FileEntity)
- Перечисление FileType
- Основные сервисы (UsersService, FilesService, AuthService)
- Связи между основными объектами

### 1b. Диаграмма классов (подробная) (`1-диаграмма-классов-подробная.mmd`)
Подробная диаграмма классов в стиле UML, показывающая:
- Все основные сущности с полным списком атрибутов и методов
- Контроллеры, сервисы и сущности
- Детальные связи между классами с указанием кардинальности
- Композиция и ассоциации между объектами

### 2. Диаграмма компонентов (`2-диаграмма-компонентов.puml` / `2-диаграмма-компонентов.mmd`)
Отображает архитектуру системы на уровне компонентов:
- Frontend (Next.js) с компонентами UI и управлением состоянием
- Backend (NestJS) с модулями аутентификации, пользователей и файлов
- База данных PostgreSQL
- Внешние сервисы (JWT, TypeORM)

### 3. Диаграмма последовательности - Авторизация (`3-диаграмма-последовательности-авторизация.puml` / `3-диаграмма-последовательности-авторизация.mmd`)
Детализирует процесс авторизации:
- Регистрация нового пользователя
- Вход существующего пользователя
- Валидация учетных данных
- Генерация JWT токенов

### 4. Диаграмма последовательности - Загрузка файла (`4-диаграмма-последовательности-загрузка-файла.puml` / `4-диаграмма-последовательности-загрузка-файла.mmd`)
Показывает процесс загрузки файла:
- Проверка JWT токена
- Валидация файла
- Сохранение файла на диск
- Сохранение метаданных в базу данных

### 5. Диаграмма последовательности - Управление файлами (`5-диаграмма-последовательности-управление-файлами.puml` / `5-диаграмма-последовательности-управление-файлами.mmd`)
Описывает операции управления файлами:
- Получение списка файлов
- Удаление файлов в корзину (soft delete)
- Восстановление файлов из корзины
- Добавление/удаление из избранного
- Получение избранных файлов

### 6. Диаграмма вариантов использования (`6-диаграмма-вариантов-использования.puml` / `6-диаграмма-вариантов-использования.mmd`)
Показывает все функциональные возможности системы с точки зрения пользователя:
- Аутентификация и авторизация (регистрация, вход, выход, профиль)
- Управление файлами (загрузка, просмотр, скачивание, удаление)
- Организация файлов (избранное, фильтрация, поиск)
- Просмотр по категориям (фото, документы, видео, аудио, архивы)
- Работа с корзиной
- Просмотр статистики

### 7. Диаграмма состояний (`7-диаграмма-состояний.puml` / `7-диаграмма-состояний.mmd`)
Отображает жизненный цикл файла в системе:
- Создание файла (загрузка и инициализация)
- Активное состояние (в избранном / не в избранном)
- Состояние в корзине (soft delete)
- Окончательное удаление
- Переходы между состояниями

### 8. Диаграмма развертывания (`8-диаграмма-развертывания.puml` / `8-диаграмма-развертывания.mmd`)
Показывает инфраструктуру и развертывание системы:
- Клиентское устройство (веб-браузер)
- Frontend (Next.js приложение)
- Backend (NestJS API сервер)
- База данных (PostgreSQL)
- Файловое хранилище
- Docker контейнеры
- Внешние зависимости и сервисы

### 9. Общая диаграмма последовательности (`9-общая-диаграмма-последовательности.puml` / `9-общая-диаграмма-последовательности.mmd`)
Объединяет все основные процессы системы в одной диаграмме:
1. Регистрация пользователя
2. Вход в систему
3. Получение списка файлов
4. Загрузка файла
5. Удаление файлов в корзину
6. Восстановление файлов из корзины
7. Добавление в избранное
8. Получение избранных файлов

Эта диаграмма показывает полный жизненный цикл взаимодействия пользователя с системой от регистрации до работы с файлами.

### 10. ER-диаграмма (`10-ER-диаграмма.mmd`)
Диаграмма "сущность-связь" (Entity-Relationship), показывающая структуру базы данных:
- Сущность **ПОЛЬЗОВАТЕЛЬ** с атрибутами (id, email, password, fullName)
- Сущность **ФАЙЛ** с атрибутами (id, filename, originalname, size, mimetype, userId, createdAt, deletedAt, isFavorite)
- Связь один-ко-многим между пользователем и файлами
- Первичные ключи (PK) и внешние ключи (FK)
- Описание каждого атрибута на русском языке

## Как использовать

### Mermaid (рекомендуется)

#### Онлайн просмотр
1. Откройте [Mermaid Live Editor](https://mermaid.live/)
2. Скопируйте содержимое нужного `.mmd` файла (без обрамляющих ```mermaid)
3. Вставьте в редактор и просмотрите диаграмму

#### GitHub/GitLab
Диаграммы Mermaid автоматически отображаются в файлах `.md` на GitHub и GitLab. Просто вставьте код из `.mmd` файла в markdown документ.

#### VS Code расширение
Установите расширение "Markdown Preview Mermaid Support" в VS Code для предпросмотра диаграмм прямо в редакторе.

#### Локальная установка
```bash
npm install -g @mermaid-js/mermaid-cli
mmdc -i диаграмма.mmd -o диаграмма.png
```

#### Конвертация в изображения
Для конвертации всех диаграмм в PNG изображения:

**Windows:**
- Двойной клик на `convert-all.bat` (требуется установленный Mermaid CLI)
- Или в PowerShell: `.\convert-all.bat`

**Node.js скрипт:**
```bash
node convert-all.js
```

**Ручная конвертация одной диаграммы:**
```bash
mmdc -i 1-диаграмма-классов-упрощенная.mmd -o 1-диаграмма-классов-упрощенная.png -w 2400 -H 1800
```

Подробные инструкции см. в файле `convert-to-images.md`

### PlantUML

#### Онлайн просмотр
1. Откройте [PlantUML Online Server](http://www.plantuml.com/plantuml/uml/)
2. Скопируйте содержимое нужного `.puml` файла
3. Вставьте в редактор и нажмите "Submit"

#### Локальная установка
1. Установите Java (требуется для PlantUML)
2. Установите PlantUML:
   ```bash
   npm install -g node-plantuml
   ```
3. Сгенерируйте изображения:
   ```bash
   plantuml *.puml
   ```

#### VS Code расширение
Установите расширение "PlantUML" в VS Code для предпросмотра диаграмм прямо в редакторе.

## Технологии системы

- **Backend**: NestJS (TypeScript)
- **Frontend**: Next.js (React)
- **База данных**: PostgreSQL
- **ORM**: TypeORM
- **Аутентификация**: JWT (JSON Web Tokens)
- **Хранилище файлов**: Локальная файловая система

## Структура системы

Система состоит из трех основных модулей:
1. **Модуль аутентификации** - регистрация, вход, JWT токены
2. **Модуль пользователей** - управление профилями пользователей
3. **Модуль файлов** - загрузка, удаление, восстановление, избранное
