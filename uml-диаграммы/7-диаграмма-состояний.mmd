```mermaid
stateDiagram-v2
    [*] --> Создан : загрузка файла

    state Создан {
        [*] --> Инициализация
        Инициализация : Сохранение на диск
        Инициализация : Создание записи в БД
        Инициализация --> [*]
    }

    Создан --> Активен : файл успешно загружен

    state Активен {
        [*] --> НеВИзбранном
        НеВИзбранном --> ВИзбранном : добавить в избранное
        ВИзбранном --> НеВИзбранном : убрать из избранного
    }

    Активен --> ВКорзине : удаление файла (soft delete)

    state ВКорзине {
        [*] --> ОжидаетВосстановления
        ОжидаетВосстановления : deletedAt != NULL
        ОжидаетВосстановления --> [*]
    }

    ВКорзине --> Активен : восстановление файла
    ВКорзине --> Удален : окончательное удаление (очистка корзины)

    state Удален {
        [*] --> ФизическоеУдаление
        ФизическоеУдаление : Удаление файла с диска
        ФизическоеУдаление : Удаление записи из БД
        ФизическоеУдаление --> [*]
    }

    Удален --> [*]

    note right of Создан
        Файл только что загружен
        Сохраняется на диск и в БД
        userId связывается с файлом
    end note

    note right of Активен
        Файл доступен пользователю
        Может быть в избранном
        или не в избранном
        deletedAt = NULL
    end note

    note right of ВКорзине
        Файл помечен как удаленный
        deletedAt != NULL
        Физически файл еще существует
        Можно восстановить
    end note

    note right of Удален
        Файл окончательно удален
        Удален с диска
        Удалена запись из БД
        Восстановление невозможно
    end note
```
